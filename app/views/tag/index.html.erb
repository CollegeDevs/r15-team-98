<% content_for :title do %>Instant-search<% end %>

<h1>Instant-search example</h1>

<div class="well">
  A <code>Google-like</code> instant-search based on <code>AlgoliaSearch JS Client</code> + <code>Hogan</code> example.
</div>
 <div class="row">
<form class="col s12">
   <div class="row">
    <div class="input-field col s12">
      <input placeholder="Placeholder" id="user_name" type="text" class="validate">
      <label for="user_name">Hey lets get started!</label>
      <div id="hits" class="collection">
      </div>
</div>
  </div>
  </form>
 </div>   



<script type="text/javascript">
  $(document).ready(function() {
    var index = new AlgoliaSearch('AAHPH6RMMW', 'ca7cddacfe022b6d988443bce51483d4').initIndex('<%= Tag.index_name %>');
    var hitTemplate = '<div class="hit-instant-search">' +
      '<a class="collection-item" href="/tag/{{{name}}}">{{{_highlightResult.name.value}}}</a>'  +
    '</div>';
    var hitTemplateCompiled = Hogan.compile(hitTemplate);
    function search(v) {
      index.search(v, function(success, content) {
        if (!success) {
          console.log("Error: " + JSON.stringify(content));
          return;
        }
        $('#hits').html('');
        $('#hits').append('<div class="processing_time pull-right">Processing time: ' + content.processingTimeMS + 'ms</div>');
        $('#hits').append('<div class="nb_hits">Nb hits: ' + content.nbHits + '</div>');
        for (var i = 0; i < content.hits.length; ++i) {
          $('#hits').append(hitTemplateCompiled.render(content.hits[i]));
        }
      }, { hitsPerPage: 20 });
    }
    $('input#user_name').change(function() {
      search($(this).val());
    }).keyup(function(e) {
      if (e.which == 27) {
        $(this).val('').change();
        return;
      }
      search($(this).val());
    }).focus(function(){
      $(this).attr("placeholder", "");
    }).blur(function(){
      $(this).attr("placeholder", "Search");
    }).focus();
    $('.search-terms a').click(function(e) {
      $("input#user_name").val($(this).text()).change().focus();
    });
    search('');
  });
</script>



